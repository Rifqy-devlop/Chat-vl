<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WhatsApp</title>

<style>
*{box-sizing:border-box;}
body{
    margin:0;
    font-family:Segoe UI, Arial, sans-serif;
    background:#000;
    height:100vh;
    display:flex;
    flex-direction:column;
}

/* HEADER */
.header{
    background:#111;
    color:white;
    display:flex;
    align-items:center;
    padding:10px;
}
.header img{
    width:40px;height:40px;border-radius:50%;
    margin-right:10px;
    object-fit:cover;
    cursor:pointer;
}
.name{font-weight:bold;cursor:pointer;}
.status{font-size:12px;opacity:.7}

/* CHAT */
.chat{
    flex:1;
    overflow-y:auto;
    padding:10px;
    display:flex;
    flex-direction:column;
}

/* BUBBLE */
.message{
    max-width:75%;
    padding:8px 10px;
    margin:4px 0;
    border-radius:8px;
    font-size:14px;
    color:white;
    word-wrap:break-word;
}
.left{background:#1f1f1f;align-self:flex-start;}
.right{background:#0084ff;align-self:flex-end;}

.time{
    font-size:10px;
    text-align:right;
    margin-top:3px;
    opacity:.8;
}
.check{color:#00bfff;font-weight:bold;}

.message img{
    max-width:100%;
    border-radius:6px;
    margin-top:5px;
}

/* INPUT */
.input-area{
    background:#111;
    padding:8px;
    display:flex;
    gap:5px;
    align-items:center;
}
select,input{
    background:#222;
    color:white;
    border:none;
    padding:8px;
    border-radius:10px;
}
input[type=text]{flex:1;border-radius:20px;}
button{
    background:#0084ff;
    color:white;
    border:none;
    border-radius:50%;
    width:40px;height:40px;
    cursor:pointer;
}
button:active{transform:scale(.9);}

/* MODAL */
.modal{
    position:fixed;
    bottom:0;
    left:0;
    width:100%;
    background:#111;
    border-top-left-radius:15px;
    border-top-right-radius:15px;
    padding:15px;
    display:none;
}
.modal button{
    width:100%;
    border-radius:10px;
    margin:5px 0;
    height:45px;
}
.danger{background:#ff3b3b;}
.close{background:#444;}
</style>
</head>
<body>

<div class="header">
    <img id="profilePic">
    <div>
        <div class="name" id="profileName"></div>
        <div class="status">online</div>
    </div>
</div>

<div class="chat" id="chatBox"></div>

<div class="input-area">
    <select id="sideSelect">
        <option value="right">»</option>
        <option value="left">«</option>
    </select>

    <input type="file" id="imageInput" accept="image/*" hidden>
    <button onclick="imageInput.click()">+</button>

    <input type="text" id="msgInput" placeholder="Ketik pesan">
    <button onclick="sendMsg()">➤</button>
</div>

<div class="modal" id="modal">
    <button onclick="editMessage()">Edit</button>
    <button class="danger" onclick="deleteMessage()">Hapus</button>
    <button class="danger" onclick="deleteAll()">Hapus Semua Chat</button>
    <button class="close" onclick="closeModal()">Batal</button>
</div>

<input type="file" id="profileInput" accept="image/*" hidden>

<script>
let chatData = JSON.parse(localStorage.getItem("chatData")) || [];
let profileName = localStorage.getItem("profileName") || "GANTI NAMA";
let profilePic = localStorage.getItem("profilePic") || "";
let selectedIndex=null;
let pressTimer;

const chatBox=document.getElementById("chatBox");
const msgInput=document.getElementById("msgInput");
const sideSelect=document.getElementById("sideSelect");
const imageInput=document.getElementById("imageInput");
const modal=document.getElementById("modal");
const profileNameEl=document.getElementById("profileName");
const profilePicEl=document.getElementById("profilePic");
const profileInput=document.getElementById("profileInput");

/* LOAD PROFILE */
profileNameEl.innerText=profileName;
profilePicEl.src=profilePic || "https://via.placeholder.com/40";

/* SAVE */
function saveChat(){
    localStorage.setItem("chatData",JSON.stringify(chatData));
}
function saveProfile(){
    localStorage.setItem("profileName",profileName);
    localStorage.setItem("profilePic",profilePic);
}

/* RENDER CHAT */
function renderChat(){
    chatBox.innerHTML="";
    chatData.forEach((msg,i)=>{
        let div=document.createElement("div");
        div.className="message "+msg.side;

        if(msg.type==="text"){
            div.innerHTML="<span>"+msg.content+"</span>";
        }else{
            div.innerHTML="<img src='"+msg.content+"'>";
        }

        let time="<div class='time'>"+msg.time;
        if(msg.side==="right"){
            time+=" <span class='check'>✓✓</span>";
        }
        time+="</div>";
        div.innerHTML+=time;

        div.addEventListener("touchstart",()=>{
            pressTimer=setTimeout(()=>{
                selectedIndex=i;
                modal.style.display="block";
            },5000);
        });
        div.addEventListener("touchend",()=>clearTimeout(pressTimer));

        chatBox.appendChild(div);
    });
    chatBox.scrollTop=chatBox.scrollHeight;
}

/* TIME */
function getTime(){
    let now=new Date();
    return now.getHours().toString().padStart(2,'0')+":"+now.getMinutes().toString().padStart(2,'0');
}

/* SEND TEXT */
function sendMsg(){
    let text=msgInput.value.trim();
    if(text){
        chatData.push({
            type:"text",
            content:text,
            side:sideSelect.value,
            time:getTime()
        });
        saveChat();
        renderChat();
        msgInput.value="";
    }
}

/* SEND IMAGE */
imageInput.addEventListener("change",function(){
    let file=this.files[0];
    if(file){
        let reader=new FileReader();
        reader.onload=e=>{
            chatData.push({
                type:"image",
                content:e.target.result,
                side:sideSelect.value,
                time:getTime()
            });
            saveChat();
            renderChat();
        }
        reader.readAsDataURL(file);
    }
});

/* EDIT NAME */
profileNameEl.onclick=function(){
    let newName=prompt("Ganti nama:");
    if(newName){
        profileName=newName;
        profileNameEl.innerText=newName;
        saveProfile();
    }
};

/* EDIT PHOTO */
profilePicEl.onclick=function(){
    profileInput.click();
};
profileInput.addEventListener("change",function(){
    let file=this.files[0];
    if(file){
        let reader=new FileReader();
        reader.onload=e=>{
            profilePic=e.target.result;
            profilePicEl.src=profilePic;
            saveProfile();
        }
        reader.readAsDataURL(file);
    }
});

/* MODAL ACTION */
function editMessage(){
    if(chatData[selectedIndex].type==="text"){
        let newText=prompt("Edit pesan:");
        if(newText){
            chatData[selectedIndex].content=newText;
            saveChat();
            renderChat();
        }
    }
    closeModal();
}
function deleteMessage(){
    chatData.splice(selectedIndex,1);
    saveChat();
    renderChat();
    closeModal();
}
function deleteAll(){
    if(confirm("Hapus semua chat?")){
        chatData=[];
        saveChat();
        renderChat();
    }
    closeModal();
}
function closeModal(){
    modal.style.display="none";
}

renderChat();
</script>

</body>
</html>